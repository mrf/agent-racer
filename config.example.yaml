# Agent Racer Configuration Example
# Copy this to ~/.config/agent-racer/config.yaml to customize settings

server:
  port: 8080
  host: "127.0.0.1"
  # Optional: CORS allowed origins (empty = same-origin only)
  allowed_origins: []
  # Optional: Authentication token (empty = no auth required)
  auth_token: ""

# Session source configuration
sources:
  claude: true        # Claude Code session monitoring (default: enabled)
  codex: false        # OpenAI Codex CLI monitoring (default: disabled, pre-alpha)
  gemini: false       # Google Gemini CLI monitoring (default: disabled, pre-alpha)

monitor:
  # How often to poll agent sources for updates
  poll_interval: 1s
  # How often to take snapshot broadcasts
  snapshot_interval: 5s
  # Minimum time between broadcast updates
  broadcast_throttle: 100ms
  # When to mark a session as stale
  session_stale_after: 2m
  # When to remove completed sessions from display
  completion_remove_after: 8s
  # Directory to store session end markers (XDG_STATE_HOME/agent-racer/session-end by default)
  session_end_dir: ""
  # CPU threshold (%) for detecting active processing (churning state)
  churning_cpu_threshold: 15.0
  # If true, only consider churning when both CPU and TCP connections are active
  churning_requires_network: false

# Model context token limits
# Keys ending with * are prefix patterns â€” longest match wins.
# Exact names take priority over prefixes.
models:
  # Claude models (all current variants use 200K)
  claude-*: 200000
  # Codex models (fallback; Codex reports context window dynamically)
  gpt-*-codex: 272000
  codex-*: 200000
  # Gemini models (prefix patterns cover all variants)
  gemini-2.5-*: 1048576
  gemini-2.0-*: 1048576
  gemini-3-*: 1000000
  gemini-1.5-pro*: 2097152
  gemini-1.5-flash*: 1048576
  # Default fallback
  default: 200000

# Token normalization strategy per agent source
# Controls how context utilization is derived when a source may not
# report real token counts. The "tokenEstimated" field on each session
# tells frontends whether the value is actual or heuristic.
token_normalization:
  # Per-source strategy: "usage", "estimate", or "message_count"
  #   usage         - use real token counts from the source (default for known agents)
  #   estimate      - estimate tokens from message count * tokens_per_message
  #   message_count - same as estimate (message-count heuristic)
  # The "default" key applies to any source not listed explicitly.
  strategies:
    claude: usage
    codex: usage
    gemini: usage
    default: estimate
  # Estimated token cost per message (user or assistant). Used by the
  # estimate/message_count strategies, and as a fallback for "usage"
  # sources that have not yet reported token data.
  tokens_per_message: 2000

# Privacy controls for session metadata
# Use these to limit what data is broadcast to connected clients.
privacy:
  # Replace full directory paths with just the last component
  # e.g. "/home/user/secret-project" becomes "secret-project"
  mask_working_dirs: false
  # Replace session IDs with opaque short hashes
  mask_session_ids: false
  # Hide process IDs from broadcast data
  mask_pids: false
  # Hide tmux pane locations from broadcast data
  mask_tmux_targets: false
  # Allowlist: only broadcast sessions whose working directory (or a
  # parent directory) matches at least one glob pattern. Empty list means
  # all sessions are allowed. Uses Go filepath.Match syntax (* matches
  # any non-separator sequence). Patterns are checked against the path
  # and all its parents, so "/home/user/work/*" matches nested paths
  # like "/home/user/work/foo/bar".
  # Example: ["/home/user/work/*", "/home/user/projects/*"]
  allowed_paths: []
  # Denylist: exclude sessions whose working directory (or a parent)
  # matches any pattern. Evaluated after allowed_paths.
  # Example: ["/home/user/work/secret-*", "/tmp/*"]
  blocked_paths: []

# Sound settings
sound:
  # Master enable/disable for all sounds
  enabled: true
  # Master volume (0.0 - 1.0)
  master_volume: 1.0
  # Ambient sounds volume (crowd, wind, engine hums)
  ambient_volume: 1.0
  # Sound effects volume (gear shift, victory, crash, etc.)
  sfx_volume: 1.0
  # Enable/disable ambient sounds independently
  enable_ambient: true
  # Enable/disable sound effects independently
  enable_sfx: true
